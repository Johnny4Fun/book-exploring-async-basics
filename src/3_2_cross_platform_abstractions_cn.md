# 编写跨平台的抽象代码

如果将针对Linux和MacOS的代码单独剥离出来，其实并没有那么多的代码。然而，一旦需要支持跨平台，代码量就会急剧膨胀。

我个人的经验是：一般Linux和MacOS有更简单的API，需要编写的代码量会少一些，通常（但不总是）完全相同的API在这两个系统下都是有效的。

而Windows相对更加复杂，需要你去创建更多的结构体来传递信息（而不是直接使用内建的原生类型），而且通常需要更多的代码来实现。Windows有非常好的文档，虽然代码工作量可能更多，但是官方文档的确非常有用。

正是因为跨平台的复杂性，Rust的社区（其他语言通常也会有类似的组织）提供了包括[libc](https://github.com/rust-lang/libc)在内的一系列crate，这些crate将大多数的方法和所需的常量都归档在一起，所以你可以很方便地去查阅。

# 关于“潜在的“复杂性的说明

在这个层面上编写跨平台代码时，需要隐藏大量的复杂逻辑。其中一个难点就是让针对特定平台的代码有效，能够**正确**且**安全**地执行。而覆盖所有的边界情况则是另一个额外的挑战。

**我们是否能100%确定在Rust中使用的所有有效的“utf-8”码点就是Windows能够正确显示的、有效的“utf-16”编码的Unicode**

**我们在Rust里用的所有有效的`uft-8`码点，是否就是能被Windows正确显示的、有效的"utf-16"编码的Unicode字符，你能100%确定吗？**

我认为答案是Yes，但是要100%确保这一点，[并没有想象的那么简单](https://en.wikipedia.org/wiki/Comparison_of_Unicode_encodings)。